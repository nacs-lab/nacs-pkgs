# Maintainer: Alexey Pavlov <alexpux@gmail.com>
# Contributor: JÃ¼rgen Pfeifer <juergen@familiepfeifer.de>

pkgbase=mingw-w64-sleef-git
pkgname="${MINGW_PACKAGE_PREFIX}-sleef-git"
pkgrel=1
pkgver=3.3.1.38.gca4fd10
pkgdesc="SIMD Library for Evaluating Elementary Functions, vectorized libm and DFT (mingw-w64)"
provides=("${MINGW_PACKAGE_PREFIX}-sleef")
arch=('any')
url="http://sleef.org/"
license=('custom')
provides=("${MINGW_PACKAGE_PREFIX}-sleef")
conflicts=("${MINGW_PACKAGE_PREFIX}-sleef")
replaces=("${MINGW_PACKAGE_PREFIX}-sleef")
options=('strip' 'staticlibs')
depends=("${MINGW_PACKAGE_PREFIX}-gcc-libs")
makedepends=("git"
             "${MINGW_PACKAGE_PREFIX}-clang"
             "${MINGW_PACKAGE_PREFIX}-cmake")
source=("git://github.com/shibatch/sleef")
sha256sums=('SKIP')

pkgver() {
  cd sleef

  git describe --tags | sed -e 's/-/./g'
}

build() {
  cd sleef

  mkdir -p build
  cd build

  CC=${MINGW_PREFIX}/bin/clang CXX=${MINGW_PREFIX}/bin/clang++ "${MINGW_PREFIX}"/cmake .. \
    -G"MSYS Makefiles" -DCMAKE_BUILD_TYPE=RelWithDebInfo \
    -DCMAKE_INSTALL_PREFIX="$(cygpath -a "${MINGW_PREFIX}")"
  make
}

package() {
  cd sleef/build

  make install DESTDIR="$pkgdir"
}
